# Supabase æ•°æ®åº“è®¾ç½®æŒ‡å—

## ğŸ—„ï¸ æ­¥éª¤1ï¼šç™»å½•Supabaseæ§åˆ¶å°

1. è®¿é—® [https://supabase.com](https://supabase.com)
2. ç™»å½•ä½ çš„è´¦æˆ·
3. é€‰æ‹©ä½ çš„é¡¹ç›®

## ğŸ—„ï¸ æ­¥éª¤2ï¼šåˆ›å»ºæ•°æ®åº“è¡¨

1. åœ¨Supabaseæ§åˆ¶å°ä¸­ï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„ **"SQL Editor"**
2. ç‚¹å‡» **"New query"** åˆ›å»ºæ–°æŸ¥è¯¢
3. å¤åˆ¶å¹¶ç²˜è´´ `supabase-setup.sql` æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹
4. ç‚¹å‡» **"Run"** æ‰§è¡ŒSQLè„šæœ¬

## ğŸ—„ï¸ æ­¥éª¤3ï¼šéªŒè¯è¡¨åˆ›å»º

æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢æ¥éªŒè¯è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š

```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_type = 'BASE TABLE';

-- æŸ¥çœ‹usersè¡¨ç»“æ„
SELECT column_name, data_type, is_nullable
FROM information_schema.columns 
WHERE table_name = 'users' 
AND table_schema = 'public';
```

## ğŸ—„ï¸ æ­¥éª¤4ï¼šé…ç½®ç¯å¢ƒå˜é‡

ç¡®ä¿ä½ çš„ `.env.local` æ–‡ä»¶åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```env
# Supabaseé…ç½®
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here

# NextAuthé…ç½®
NEXTAUTH_SECRET=your_nextauth_secret_here
NEXTAUTH_URL=http://localhost:3000

# OpenAIé…ç½®
OPENAI_API_KEY=your_openai_api_key_here
```

## ğŸ—„ï¸ æ­¥éª¤5ï¼šè·å–Supabaseé…ç½®ä¿¡æ¯

### è·å–Project URLï¼š
1. åœ¨Supabaseæ§åˆ¶å°ä¸­ï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„ **"Settings"**
2. ç‚¹å‡» **"API"**
3. å¤åˆ¶ **"Project URL"**

### è·å–Service Role Keyï¼š
1. åœ¨åŒä¸€é¡µé¢ï¼Œæ‰¾åˆ° **"Project API keys"** éƒ¨åˆ†
2. å¤åˆ¶ **"service_role"** å¯†é’¥ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦åˆ†äº«ï¼‰

## ğŸ—„ï¸ æ­¥éª¤6ï¼šæµ‹è¯•æ•°æ®åº“è¿æ¥

å¯åŠ¨å¼€å‘æœåŠ¡å™¨åï¼Œå°è¯•æ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·æ¥æµ‹è¯•æ•°æ®åº“è¿æ¥ï¼š

```bash
npm run dev
```

ç„¶åè®¿é—® `http://localhost:3000/register` è¿›è¡Œæµ‹è¯•ã€‚

## ğŸ“Š æ•°æ®åº“è¡¨è¯´æ˜

### 1. users è¡¨
- `id`: ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
- `username`: ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- `email`: é‚®ç®±åœ°å€ï¼ˆå”¯ä¸€ï¼‰
- `password`: åŠ å¯†åçš„å¯†ç 
- `is_paid_user`: æ˜¯å¦ä¸ºä»˜è´¹ç”¨æˆ·
- `daily_usage_count`: å½“æ—¥ä½¿ç”¨æ¬¡æ•°
- `last_usage_date`: æœ€åä½¿ç”¨æ—¥æœŸ
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

### 2. analysis_records è¡¨
- `id`: è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦
- `user_id`: ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
- `contract_text`: åˆåŒæ–‡æœ¬å†…å®¹
- `analysis_result`: åˆ†æç»“æœ
- `model_used`: ä½¿ç”¨çš„AIæ¨¡å‹
- `tokens_used`: æ¶ˆè€—çš„tokenæ•°é‡
- `created_at`: åˆ›å»ºæ—¶é—´

### 3. user_usage_stats è¡¨
- `id`: ç»Ÿè®¡è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦
- `user_id`: ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
- `date`: ç»Ÿè®¡æ—¥æœŸ
- `usage_count`: å½“æ—¥ä½¿ç”¨æ¬¡æ•°
- `total_tokens`: å½“æ—¥æ€»tokenæ¶ˆè€—
- `created_at`: åˆ›å»ºæ—¶é—´

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **è¡Œçº§å®‰å…¨ç­–ç•¥ (RLS)**: ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **å¯†ç åŠ å¯†**: ä½¿ç”¨bcryptåŠ å¯†å­˜å‚¨å¯†ç 
- **å”¯ä¸€çº¦æŸ**: ç”¨æˆ·åå’Œé‚®ç®±å”¯ä¸€æ€§çº¦æŸ
- **å¤–é”®çº¦æŸ**: ç¡®ä¿æ•°æ®å®Œæ•´æ€§

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **Service Role Key**: è¿™æ˜¯ç®¡ç†å‘˜æƒé™çš„å¯†é’¥ï¼Œåªèƒ½åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼Œä¸è¦æš´éœ²ç»™å‰ç«¯
2. **RLSç­–ç•¥**: å¦‚æœé‡åˆ°æƒé™é—®é¢˜ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´RLSç­–ç•¥
3. **å¤‡ä»½**: å®šæœŸå¤‡ä»½æ•°æ®åº“æ•°æ®
4. **ç›‘æ§**: ç›‘æ§APIä½¿ç”¨æƒ…å†µå’Œé”™è¯¯æ—¥å¿—

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜ï¼š

1. **è¿æ¥é”™è¯¯**: æ£€æŸ¥SUPABASE_URLå’ŒSUPABASE_SERVICE_ROLE_KEYæ˜¯å¦æ­£ç¡®
2. **æƒé™é”™è¯¯**: æ£€æŸ¥RLSç­–ç•¥æ˜¯å¦æ­£ç¡®é…ç½®
3. **è¡¨ä¸å­˜åœ¨**: ç¡®ä¿SQLè„šæœ¬æ‰§è¡ŒæˆåŠŸ
4. **æ•°æ®ç±»å‹é”™è¯¯**: æ£€æŸ¥å­—æ®µç±»å‹æ˜¯å¦åŒ¹é…

### è°ƒè¯•å‘½ä»¤ï¼š

```sql
-- æ£€æŸ¥ç”¨æˆ·è¡¨æ•°æ®
SELECT * FROM users LIMIT 5;

-- æ£€æŸ¥åˆ†æè®°å½•
SELECT * FROM analysis_records LIMIT 5;

-- æ£€æŸ¥ä½¿ç”¨ç»Ÿè®¡
SELECT * FROM user_usage_stats LIMIT 5;
```

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] æ‰§è¡Œäº†supabase-setup.sqlè„šæœ¬
- [ ] éªŒè¯äº†æ‰€æœ‰è¡¨åˆ›å»ºæˆåŠŸ
- [ ] é…ç½®äº†ç¯å¢ƒå˜é‡
- [ ] æµ‹è¯•äº†ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
- [ ] æµ‹è¯•äº†ç”¨æˆ·ç™»å½•åŠŸèƒ½
- [ ] æµ‹è¯•äº†åˆåŒåˆ†æåŠŸèƒ½

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œä½ çš„Supabaseæ•°æ®åº“å°±é…ç½®å®Œæˆäº†ï¼ğŸ‰ 